{
    "id": null,
    "uid": null,
    "title": "RUNTIME - Essentials",
    "tags": ["runtime", "process"],
    "timezone": "browser",
    "schemaVersion": 37,
    "version": 1,
    "templating": {
      "list": [
        {
          "name": "service",
          "type": "query",
          "datasource": "Prometheus",
          "refresh": 1,
          "query": "label_values(process_start_time_seconds, service)"
        }
      ]
    },
    "panels": [
      {
        "type": "timeseries",
        "title": "CPU time (rate)",
        "targets": [
          {
            "expr": "sum(rate(process_cpu_seconds_total{service=\"$service\"}[$__rate_interval]))",
            "legendFormat": "cpu rate",
            "datasource": "Prometheus",
            "refId": "A"
          }
        ],
        "gridPos": { "x": 0, "y": 0, "w": 12, "h": 8 }
      },
      {
        "type": "timeseries",
        "title": "Memory RSS (bytes)",
        "targets": [
          {
            "expr": "sum(process_resident_memory_bytes{service=\"$service\"})",
            "legendFormat": "rss",
            "datasource": "Prometheus",
            "refId": "A"
          }
        ],
        "fieldConfig": { "defaults": { "unit": "bytes" }, "overrides": [] },
        "gridPos": { "x": 12, "y": 0, "w": 12, "h": 8 }
      },
      {
        "type": "timeseries",
        "title": "Heap used (bytes)",
        "targets": [
          {
            "expr": "sum(nodejs_heap_size_used_bytes{service=\"$service\"})",
            "legendFormat": "heap used",
            "datasource": "Prometheus",
            "refId": "A"
          }
        ],
        "fieldConfig": { "defaults": { "unit": "bytes" }, "overrides": [] },
        "gridPos": { "x": 0, "y": 8, "w": 12, "h": 8 }
      },
      {
        "type": "timeseries",
        "title": "Event loop lag p99 (s)",
        "targets": [
          {
            "expr": "histogram_quantile(0.99, sum by (le)(rate(nodejs_eventloop_lag_seconds_bucket{service=\"$service\"}[5m])))",
            "legendFormat": "p99",
            "datasource": "Prometheus",
            "refId": "A"
          }
        ],
        "fieldConfig": { "defaults": { "unit": "s" }, "overrides": [] },
        "gridPos": { "x": 12, "y": 8, "w": 12, "h": 8 }
      },
      {
        "type": "timeseries",
        "title": "GC duration avg (s)",
        "targets": [
          {
            "expr": "sum(rate(nodejs_gc_duration_seconds_sum{service=\"$service\"}[5m])) / clamp_min(sum(rate(nodejs_gc_duration_seconds_count{service=\"$service\"}[5m])), 1)",
            "legendFormat": "gc avg",
            "datasource": "Prometheus",
            "refId": "A"
          }
        ],
        "fieldConfig": { "defaults": { "unit": "s" }, "overrides": [] },
        "gridPos": { "x": 0, "y": 16, "w": 12, "h": 8 }
      },
      {
        "type": "timeseries",
        "title": "Uptime (s)",
        "targets": [
          {
            "expr": "sum(time() - process_start_time_seconds{service=\"$service\"})",
            "legendFormat": "uptime",
            "datasource": "Prometheus",
            "refId": "A"
          }
        ],
        "fieldConfig": { "defaults": { "unit": "s" }, "overrides": [] },
        "gridPos": { "x": 12, "y": 16, "w": 12, "h": 8 }
      }
    ]
  }